<head>
    <script type="text/javascript" src="__STATIC__/js/jquery.min.js"></script>
    <script type="text/javascript" src="__STATIC__/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="__STATIC__/js/service.js"></script>
    <!--<link rel="stylesheet" href="__STATIC__/css/bootstrap.offcanvas.min.css"/>-->

    <script type="text/javascript" src="__STATIC__/js/sidebar.min.js"></script>
    <link rel="stylesheet" href="__STATIC__/css/sidebar.min.css"/>

</head>
<body class="body-offcanvas user-info-edit">

<!--性别选择-->
<div class="modal fade" id="sex-select" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
    <div class="modal-dialog modal-sm">
        <div class="modal-content sex-selection">
            <div class="sex-header">
                性别
            </div>
            <div class="sex-item container-fluid" id="male">
                <div class="row">
                    <div class="col-xs-8">男</div>
                    <div class="col-xs-4">
                        <span class="icon-checkmark" id="male-chcke"></span>
                    </div>
                </div>
            </div>
            <div class="sex-item container-fluid" id="female">
                <div class="row">
                    <div class="col-xs-8">女</div>
                    <div class="col-xs-4">
                        <span class="icon-checkmark" id="female-check"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!--选择地区--省-->
    <div class="ui right sidebar" id="province-sidebar" style="width: 100%">
        <div class="sidebar-container">
            <include file="Public:user_center_header" target="#province-sidebar" title="选择地区"/>
            <!--已选地区-->
            <div class="area-zone container-fluid">
                <div class="row city-selected-item">
                    <div class="col-xs-8">{$user.provinceName}</div>
                    <div class="col-xs-4 area-zone-selected">已选地区</div>
                </div>
            </div>
            <!--省区显示-->
            <div class="area-zone container-fluid">
                <volist name="provinces" id="vo">
                    <div class="row city-selected-item" >
                        <div class="col-xs-12  offcanvas-toggle"  data-toggle="offcanvas" data-target="#city-select-canvas">{$vo.area_name}</div>
                    </div>
                    <div class="divider"></div>
                </volist>

            </div>
        </div>
    </div>

    <!--选择地区--市-->
    <div class="ui right sidebar" id="city-sidebar" style="width: 100%">
        <div class="sidebar-container">
            <include file="Public:user_center_header" target="#city-sidebar" title="选择地区"/>
            <div class="loading">
                正在加载城市
            </div>

            <div class="area-zone container-fluid" id="city-area">

            </div>
        </div>
    </div>



    <div class="ui right sidebar" id="name-sidebar" style="width: 100%">
        <div class="sidebar-container">
            <include file="Public:user_center_header" target="#name-sidebar" title="更改姓名"/>
            <div class="name-canvas">
                <input type="text" id="name" value="{$user.user_name}"/>
                <div class="text-info">
                    请输入你的名字方便联系
                </div>
                <div class="btn-container">
                    <div class="btn btn-success" id="name-commit-btn">确定</div>
                </div>
            </div>
        </div>
    </div>


<!--手机验证-->
    <div class="ui right sidebar" id="phone-sidebar" style="width: 100%">
        <div class="sidebar-container">
            <include file="Public:user_center_header" target="#phone-sidebar" title="绑定手机"/>
            <div class="phone-canvas container-fluid">
                <div class="row">
                    <div class="col-xs-8">
                        <input type="text" id="phone" value="{$user.phone}" placeholder="输入手机号码"/>
                    </div>
                    <div class="col-xs-4">
                        <div class="btn btn-default" id="get-code-btn">验证码</div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-8">
                        <input type="text" id="phone-code" placeholder="输入验证码"/>
                    </div>
                    <div class="col-xs-4">
                    </div>
                </div>

                <div class="text-info">
                    验证手机
                </div>
                <div class="btn-container">
                    <div class="btn btn-success" id="phone-commit-btn">确定</div>
                </div>
            </div>
        </div>
    </div>


    <div class="user-center-header container-fluid">
        <div class="row">
            <a href="new_user_center">
                <div class="col-xs-2 back">
                    <span class="icon-arrow-left2"></span>
                </div>
            </a>

            <div class="col-xs-10">个人信息</div>
        </div>
    </div>

<div class="user-info-contaner">
    <div class="area user-primary-info ">
        <div class="item row ">
            <div class="col-xs-3 user-icon-name">头像</div>
            <div class="col-xs-7 info">
                <img class="user-icon" src="{$user.user_icon}" alt=""/>
            </div>
            <div style="display: none" class="col-xs-1 "  >
                <img class="more-icon more-user-icon" src="__STATIC__/img/Service/iconfont-more.png" alt=""/>
            </div>
        </div>
        <div class="divider"></div>
        <div class="item row">
            <div class="col-xs-3">姓名</div>
            <div class="col-xs-7 info" id="name-value">{$user.user_name}</div>
            <div class="col-xs-1" id="name-sidebar-btn">
                <img class="more-icon" src="__STATIC__/img/Service/iconfont-more.png" alt=""/>
            </div>
        </div>
        <div class="divider"></div>
        <div class="item row">
            <div class="col-xs-3">手机</div>
            <div class="col-xs-7 info" id="user_phone">{$user.phone}</div>
            <div class="col-xs-1 "  id="phone-sidebar-btn">
                <img class="more-icon" src="__STATIC__/img/Service/iconfont-more.png" alt=""/>
            </div>
        </div>
    </div>
    <div class="area user-secondary-info">
        <div class="item row ">
            <div class="col-xs-3 ">性别</div>
            <div class="col-xs-7 info" id="user-sex">
               {$user.sex}
            </div>
            <div class="col-xs-1"  id="modal-btn">
                <img class="more-icon " src="__STATIC__/img/Service/iconfont-more.png" alt=""/>
            </div>
        </div>
        <div class="divider"></div>
        <div class="item row">
            <div class="col-xs-3">地区</div>
            <div class="col-xs-7 info" id="user-area">{$user.provinceName} {$user.cityName}</div>
            <div class="col-xs-1 " id="area-sidebar-btn">
                <img class="more-icon" src="__STATIC__/img/Service/iconfont-more.png" alt=""/>
            </div>
        </div>
    </div>
</div>



</body>


<script type="text/javascript" src="__STATIC__/js/bootstrap.offcanvas.min.js"></script>

<script>

    $('#name-sidebar-btn').on('click', function(){
        $('#name-sidebar').sidebar('toggle');
    })

    $('#phone-sidebar-btn').on('click', function(){
        $('#phone-sidebar').sidebar('toggle');
    })

    $('#area-sidebar-btn').on('click', function(){
        $('#province-sidebar').sidebar('toggle');
    })
    //定义所有的返回按钮
    $('.back-arraw-btn').on('click', function(){
        var target_id = $(this).attr('target');
        var target = $(target_id);
        target.sidebar('toggle');
    })

    $('.city-selected-item').on('click', function(){
        $('.loading').show();
        var selected_province_div = $(this).find('div');
        var selected_province = $.trim($(selected_province_div).html());
        console.log(selected_province);
        //加载地区
        $.ajax({
            url:'get_cities',
            data: {
                province_name: selected_province
            },
            type:'GET',
            dataType: 'json',
            success : function(data, status){
                console.log(data);
                $('.loading').hide();
                //生成城市列表
                html = '';
                data.forEach(function(c){
                    html += '<div class="row city-selected-item" >' +
                            '<div class="col-xs-12" >'+ c.area_name +'</div>' +
                            '</div>' +
                            '<div class="divider"></div>'
                })

                $('#city-area').html(html);

                //添加城市选择监听事件
                $('.city-selected-item').on('click', function(){
                    //获取选择的城市
                    var selected_city = $.trim($($(this).find('div')).html());
                    console.log(selected_city);
                    //发送更新数据请求
                    $.ajax({
                        url: 'update_user_area',
                        data: {
                            province : selected_province,
                            city : selected_city
                        },
                        type : 'GET',
                        dataType: 'json',
                        success: function(){

                        }
                    });
                    //更新用户信息界面,这里直接更新好了，不管后台交互成不成功
                    $('#user-area').html(selected_province +' '+ selected_city);
                    //清空城市列表
                    $('#city-area').html('');

                    //关闭offcanvas
                    $('#city-select-canvas').toggleClass('in');
//                    $('#province-select-canvas').toggleClass('in');
                })

            }
        });

        if($(selected_province_div).hasClass('js-offcanvas-has-events')){

        }else{
            $('#city-select-canvas').toggleClass('in');
        }

    })

    $('.sex-item').on('click', function(){
        var icon = $(this).find('span');
        $('.icon-checkmark').hide();
        $('#sex-select').modal('toggle');
        $(icon).show();

        $select_id = $(this).attr('id');
        var selected_sex = $select_id == 'male'?'男': '女';
        //更改性别
        $.ajax({
            url:'save_sex',
            data: {
                sex: selected_sex
            },
            type: 'GET',
            success: function(data , status){
                if(data.code == 200){
                    $('#user-sex').html(selected_sex);
                }
            }
        })

        $('#sex-select').modal('hide');

    })

    $('#modal-btn').on('click', function(){
        var sex = $.trim($('#user-sex').html());

        if(sex == '男') {
            $('#female-check').hide();
            $('#male-check').show();
        }else{
            console.log(2);

            $('#male-check').hide();
            $('#female-check').show();
        }

        $('#sex-select').modal('toggle');
    })
    $('.back').on('click', function(){
        console.log(this);
        $($(this).attr('target')).toggleClass('in');

    })


    //修改名字
    $('#name-commit-btn').on('click', function(){
        var name = $('#name').val();
        $.ajax({
            url:'save_name',
            data: {
                name: name
            },
            type: 'GET',
            success : function(){

            }
        });

        $('#name-sidebar').sidebar('toggle');
        $('#name-value').html(name);
    });

    //获取验证
    $('#get-code-btn').on('click', function(){
        util.hsTime(this);
        //发送验证码请求
        var phone = $('#phone').val();

        $.ajax(
                {
                    url:'send_msg',
                    data:{
                        new_phone :  phone
                    },
                    type:'GET',
                    success : function(){

                    }
                }
        );



    });

    $('#phone-commit-btn').on('click', function(){
        //验证
        var code = $('#phone-code').val();
        var phone = $('#phone').val();
        $.ajax({
            url: 'validate_phone_code',
            data: {code : code},
            type: 'GET',
            dataType: 'JSON',
            success : function(data, status){
                console.log(data);
                if(data.code == 200){
                    $('#user_phone').html(phone);

                }
            }
        })

        $('#user-phone-canvas').toggleClass('in');
    })


</script>
</html>